<html>
<link rel="preconnect" href="//fdn.fontcdn.ir">
<link rel="preconnect" href="//v1.fontapi.ir">
<link href="https://v1.fontapi.ir/css/Sahel" rel="stylesheet">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=0.7">
	<title>سوال ساز استوکیومتری</title>
	<link rel="stylesheet" href="styles.css">
	<link rel="stylesheet" href="switch.css">
	<link rel="stylesheet" href="checkbox.css">
	<link rel="stylesheet" href="floating-button.css">
	<script src="https://cdn.jsdelivr.net/gh/nastyox/Rando.js@master/code/plain-javascript/2.0.0/rando-min.js"></script>
	<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.2/bignumber.min.js'></script>




</head>

<body>
	<div class="header">
		<a href="index.html" class="logo">سوال ساز رندوم</a>
		<div class="header-right">
			<a class="menu" href="index.html">صفحۀ اصلی</a>
		</div>
	</div>
	<br />
	<div class="columnview">
		<div class="column">
			<div class="section">
				<h2 class="section-title">تنظیمات</h2>
			</div>

			<div class="settings-groups">
				<div class="section-content">
					<div class="section-entry"><span dir="rtl">نوع واکنش:</span>
						<label class="container">
							<input type="checkbox" id="r-combustion" checked="">
							<div class="cb-checkmark" style="background-color: #3a2c63;"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">سوختن</span>
					</div>

					<div class="section-entry"><span dir="rtl">نوع واکنش دهنده:</span>
						<label class="container">
							<input type="checkbox" id="mat-fuel" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">سوخت مایع</span>

						<label class="container">
							<input type="checkbox" id="mat-fuelgas" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">سوخت گازی</span>
					</div>

					<div class="section-entry"><span dir="rtl">واحد داده:</span>
						<label class="container">
							<input type="checkbox" id="unit1-gram" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">گرم</span>

						<label class="container">
							<input type="checkbox" id="unit1-mol" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">مول</span>

						<label class="container">
							<input type="checkbox" id="unit1-lit" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">لیتر</span>
					</div>

					<div class="section-entry"><span dir="rtl">واحد خواسته:</span>
						<label class="container">
							<input type="checkbox" id="unit2-gram" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">گرم</span>

						<label class="container">
							<input type="checkbox" id="unit2-mol" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">مول</span>

						<label class="container">
							<input type="checkbox" id="unit2-lit" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">لیتر</span>
					</div>

					<div class="section-entry" id="stp-switch"><span dir="rtl">شرایط:</span>
						<label class="container">
							<input type="checkbox" id="c_stp" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">STP</span>

						<label class="container">
							<input type="checkbox" id="c_mv" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">حجم مولی</span>

						<label class="container">
							<input type="checkbox" id="c_den" checked="">
							<div class="cb-checkmark"></div>
						</label>
						<span dir="rtl" class="settings-entry-title">چگالی</span>
					</div>
				</div>
			</div>
		</div>

		<div class="column">
			<div class="section">
				<h2 class="section-title">سوال</h2>
			</div>

			<div class="section-content">
				<div class="section-entry">
					<p class="result2" dir="rtl" id="r1">
						<span id="r1p1">‌</span>
					</p>
				</div>
			</div>
		</div>

		<div class="column">
			<div class="section">
				<h2 class="section-title">جواب</h2>
			</div>

			<div class="section-content">
				<div class="section-entry">
					<p class="result2" dir="rtl" id="a1">
						<span id="r1p1">‌</span>
					</p>
				</div>
			</div>
		</div>

	</div>
	<div class="buttonsline" style="margin-top: 1em;">
		<span dir="rtl"><button class="button ans" role="button" onclick="Answer()"><img src="assets/z.png"
					height="26px" />
				<span class="buttontext"> مشاهدۀ جواب</span>
			</button>
		</span>
		<span dir="rtl"><button class="button gen" role="button" onclick="Generate()"><img src="assets/x.png"
					height="26px" />
				<span class="buttontext"> بساز!</span>
			</button>
		</span>
		</span>
	</div>
	<script>
		// const materials = ["nacl", "feno32", "brcl", "ammonia", "methanole"];
		let fuels = ["methanol"];
		let gasfuels = ["methane"];

		let units_mass = ["mol", "gram"];
		let units_vol = ["lit", "mlit"];
		let units_all = units_mass.concat(units_vol);

		let gaslist = ["ammonia"];

		let sm = [0.9, 0.8, 0.75, 0.7, 0.6, 0.5, 0.25, 0.2, 0.125];
		let safesm = [1, 2, 4, 5, 8, 10, 16, 25];

		let material_props = { // Fuel + O2 ---> H2O + CO2
			methanol: {
				name: "متانول ", type: "fuel", mw: "32",
				mps: ["2", "3", "4", "2"],
				formula: "(CH₃OH)" // Fe(NO<sub>3</sub>)<sub>2</sub>
			},
			methane: {
				name: "گاز متان ", type: "fuelgas", mw: "16",
				mps: ["1", "2", "2", "1"],
				formula: "(CH₄)"
			},
			ammonia: { name: "آمونیاک", mw: "17", formula: "(NH₃)" },
			o2: { name: "گاز اکسیژن" },
			err: { type: "err" }
		};

		const unit_props = {
			mol: { name: "مول " },
			gram: { name: "گرم " },
			lit: { name: "لیتر " },
			mlit: { name: "میلی‌لیتر " },
		};

		addEventListener("keypress", logKey);
		function logKey(e) {
			if (e.code == "KeyX") {
				GenerateOutput();
			} else if (e.code == "KeyZ") {
				Answer();
			}
		};
		let ans;


		/* const material_props = {
			nacl: {
				type: "salt",
				compounds: ["یون سدیم", "یون کلر"], mps: ["1", "1"]
			},
			feno32: {
				type: "salt",
				compounds: ["یون آهن", "یون کلر"], mps: ["1", "1"]
			}
		}; */

		function SelectMat() {
			const mat_fuel = document.querySelector("#mat-fuel");
			const mat_fuelgas = document.querySelector("#mat-fuelgas");
			let matlist = [];
			if (mat_fuel.checked) { matlist = matlist.concat(fuels); }
			if (mat_fuelgas.checked) { matlist = matlist.concat(gasfuels); }
			if (!mat_fuel.checked && !mat_fuelgas.checked) {
				return "err";
			}

			return matlist[Math.floor(Math.random() * matlist.length)];
		}

		function GenerateAnswer(mat, qtype, v1, u1, m2, u2, tp, mtp) {
			let a;
			switch (material_props[`${mat}`].type) {
				case "fuelgas":
				case "fuel":
					switch (qtype) {
						default:
							let mv;
							if (tp != 0) {	// 0: No tp needed  ,  d: density  ,  !d: molic volume
								mv = tp.toString().replace("d", "");
								if (tp.toString().charAt(0) == "d") {
									mv = BigNumber(mv).div(BigNumber(material_props[`${mtp}`].mw));
								}
							}
							a = v1;
							console.log(a.toString());
							if (u1 == "gram") {
								a = BigNumber(a).div(BigNumber(material_props[`${mat}`].mw));
							}
							if (u1 == "lit") {
								a = BigNumber(a).div(BigNumber(mv));
							}
							console.log(a.toString());
							a = BigNumber(a).times(BigNumber(material_props[`${mat}`].mps[1])).div(BigNumber(material_props[`${mat}`].mps[0]));
							if (u2 == "gram") {
								a = BigNumber(a).times(BigNumber(32));
							}
							if (u2 == "lit") {
								a = BigNumber(a).times(BigNumber(mv));
							}
							console.log(a.toString());
							return a + " " + unit_props[`${u2}`].name + " " + material_props[`${m2}`].name; break;
					} break;
			}
		}

		function GenerateFuel(mat) {
			let type = Math.floor(Math.random() * 2); // 0: Ask Oxygen  ,  1: Ask CO2 or H2O

			const s_stp = document.querySelector("#c_stp");
			const s_mv = document.querySelector("#c_mv");
			const s_den = document.querySelector("#c_den");
			let tplist = [];
			if (s_stp.checked) { tplist.push("stp") }
			if (s_mv.checked) { tplist.push("mv") }
			if (s_den.checked) { tplist.push("den") }

			const mat_fuel = document.querySelector("#mat-fuel");
			const mat_fuelgas = document.querySelector("#mat-fuelgas");

			const u1gram = document.querySelector("#unit1-gram");
			const u1mol = document.querySelector("#unit1-mol");
			const u1lit = document.querySelector("#unit1-lit");
			let u1list = [];
			switch (material_props[`${mat}`].type) {
				case "fuel":
					u1list = [];
					if (u1gram.checked) { u1list.push("gram") }
					if (u1mol.checked) { u1list.push("mol") } break;
				case "fuelgas":
					u1list = [];
					if (u1gram.checked) { u1list.push("gram") }
					if (u1mol.checked) { u1list.push("mol") }
					if (u1lit.checked) { u1list.push("lit") } break;
			}
			if (mat_fuelgas.checked) {
				if (!u1gram.checked && !u1mol.checked && !u1lit.checked) { u1list = []; return "<span style='color: red;'>حداقل یک واحد را برای داده انتخاب کنید!</span>"; }
			}
			if (mat_fuel.checked) {
				if (!u1gram.checked && !u1mol.checked) { u1list = []; return "<span style='color: red;'>حداقل یکی از واحدهای گرم و مول را برای داده انتخاب کنید!</span>"; }
			}
			let massunit1 = u1list[Math.floor(Math.random() * u1list.length)];

			let mass1; switch (Math.floor(Math.random() * 2)) {
				case 0: // Downscale the Molar mass
					switch (massunit1) {
						case "gram":
						case "lit": mass1 = material_props[`${mat}`].mw * material_props[`${mat}`].mps[0] * sm[Math.floor(Math.random() * sm.length)];
							break;
						case "mol": mass1 = BigNumber(material_props[`${mat}`].mw * material_props[`${mat}`].mps[0] * sm[Math.floor(Math.random() * sm.length)]).div(BigNumber(10));
							break;
					} break;
				case 1:  // Upscale the Molar mass 
					switch (massunit1) {
						case "gram":
						case "lit": mass1 = material_props[`${mat}`].mw * material_props[`${mat}`].mps[0] * (Math.floor(Math.random() * 9) + 1);
							break;
						case "mol": mass1 = BigNumber(material_props[`${mat}`].mw * material_props[`${mat}`].mps[0] * (Math.floor(Math.random() * 9) + 1)).div(BigNumber(10));
							// case "mol": mass1 = BigNumber(material_props[`${mat}`].mw * material_props[`${mat}`].mps[0] * (Math.floor(Math.random() * 9) + 1)).div(BigNumber(Math.pow(10,Math.floor(-1 * Math.random() * 3))));
							break;
					} break;
			}

			const u2gram = document.querySelector("#unit2-gram");
			const u2mol = document.querySelector("#unit2-mol");
			const u2lit = document.querySelector("#unit2-lit");
			let u2list = [];
			if (u2gram.checked) { u2list.push("gram") }
			if (u2mol.checked) { u2list.push("mol") }
			if (u2lit.checked) {
				if (!s_stp.checked && !s_mv.checked && !s_den.checked) {
					return "<span style='color: red;'>حداقل یک مورد را برای شرایط فشار و دما انتخاب کنید.</span>";
				}
				u2list.push("lit");
			}
			if (!u2gram.checked && !u2mol.checked && !u2lit.checked) { u1list = []; return "<span style='color: red;'>حداقل یک واحد را برای خواسته انتخاب کنید!</span>"; }
			let massunit2 = u2list[Math.floor(Math.random() * u2list.length)];

			let mat2;

			let text_tp;
			let v_tp;
			let m_tp;

			if (units_vol.includes(massunit1) || units_vol.includes(massunit2)) {
				switch (tplist[Math.floor(Math.random() * tplist.length)]) {
					case "stp": v_tp = 22.4; text_tp = "در شرایط STP، ";
						mass1 = BigNumber(mass1).times(BigNumber(7));
						break;
					case "mv":
						if (!units_vol.includes(massunit1)) {
							tp = (Math.floor(Math.random() * 20) + 10);
							v_tp = tp.toString();
							text_tp = "در شرایطی که حجم مولی گازها " + "<math><mfrac><mrow><mi>L</mi></mrow><mrow><mi>mol</mi></mrow></mfrac></math>" + tp + " است، ";
						} else {
							tp = BigNumber(mass1).times(sm[Math.floor(Math.random() * sm.length)]);
							v_tp = tp.toString();
							text_tp = "در شرایطی که حجم مولی گازها " + "<math><mfrac><mrow><mi>L</mi></mrow><mrow><mi>mol</mi></mrow></mfrac></math>" + tp + " است، ";
						} break;
					case "den":
						m_tp = gaslist[Math.floor(Math.random() * gaslist.length)];
						tp = BigNumber(material_props[`${m_tp}`].mw).div(BigNumber(safesm[Math.floor(Math.random() * safesm.length)]));
						v_tp = String("d" + tp);
						text_tp = "در شرایطی که چگالی گاز " + material_props[`${m_tp}`].name + material_props[`${m_tp}`].formula + "، " + "<math><mfrac><mrow><mi>g</mi></mrow><mrow><mi>L</mi></mrow></mfrac></math>" + tp + " است، ";
						break;
					default:
						return "<span style='color: red;'>حداقل یک مورد را برای شرایط فشار و دما انتخاب کنید.</span>";
				}

			} else {
				text_tp = ""; v_tp = 0;
			}

			switch (type) {
				default:
					ans = GenerateAnswer(mat, type, mass1, massunit1, "o2", massunit2, v_tp, m_tp);
					return text_tp + "برای سوختن کامل " + mass1 + " " + unit_props[`${massunit1}`].name + material_props[`${mat}`].name
						+ material_props[`${mat}`].formula + "،" + " به چند " + unit_props[`${massunit2}`].name + "گاز اکسیژن نیاز داریم؟";
					break;
			}
		}

		function GenerateOutput() {
			let inft;
			let material = SelectMat();

			switch (material_props[`${material}`].type) {
				case "fuel":
				case "fuelgas": inft = GenerateFuel(material); break;
				case "err": inft = "<span style='color: red;'>حداقل یک دسته‌بندی از مواد را انتخاب کنید.</span>"
			}
			document.getElementById("r1").innerHTML = `${inft}`;
		}

		function Answer() {
			document.getElementById("a1").innerHTML = `${ans}`;
		}
	</script>




	<script>
		const gas_checkbox1 = document.querySelector("#unit1-lit");
		const gas_checkbox2 = document.querySelector("#unit2-lit");
		const stp_checkbox = document.querySelector("#stp-switch");
		stp_checkbox.style.visibility = "visible";
		gas_checkbox1.addEventListener("change", () => {
			if (gas_checkbox1.checked || gas_checkbox2.checked) {
				stp_checkbox.classList.remove('hidden');
			} else if (!gas_checkbox1.checked && !gas_checkbox2.checked) {
				stp_checkbox.classList.add('hidden');
			}
		});

		gas_checkbox2.addEventListener("change", () => {
			if (gas_checkbox1.checked || gas_checkbox2.checked) {
				stp_checkbox.classList.remove('hidden');
			} else if (!gas_checkbox1.checked && !gas_checkbox2.checked) {
				stp_checkbox.classList.add('hidden');
			}
		});

		const com_checkbox = document.querySelector("#r-combustion");
		com_checkbox.addEventListener("change", () => {
			com_checkbox.checked = true;
		});
	</script>
</body>
<div class="floating-container">
	<a href="https://github.com/aL1NaZ4R/randq-fa" target="_blank" rel="noopener noreferrer">
		<div class="floating-button">
			<svg height="64" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="50" data-view-component="true"
				style="fill: white !important;">
				<path
					d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z">
				</path>
			</svg>
		</div>
	</a>
</div>

</html>